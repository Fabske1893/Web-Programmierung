<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Füge ein neues Rezept hinzu</title>
    <link rel="stylesheet" href="../css/styleCreateRecipe.css">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
</head>
<header>
<nav>
    <a href="../Homepage.html">Startseite</a> &nbsp;&nbsp;
    <a href="../login/Logoff.html">Abmelden</a>
</nav>
<br>
</header>
<body>
    <form>
    <h1>Teilen sie ihre eigenen Rezepte mit anderen!</h1> <br>
    <h2>Füge ein neues Rezept hinzu:</h2>
    <p></p>

        <label for="recipeTitel" >Titel:</label> <br>
        <textarea type="text" id="recipeTitel" name="titel" required ></textarea><br><br>

    
        <label for="bild">Bild hochladen:</label> <br>
        <input type="file" id="bild" name="bild" accept="image/*"><br><br>
    

        <label for="zutaten">Zutaten:</label> <br>
        <textarea type="text" id="zutaten" name="zutaten" required ></textarea><br><br>

        <label for="zubereitung">Zubereitung:</label> <br>
        <textarea type="text" id="zubereitung" name="zubereitung" required ></textarea><br><br>

        <label for="difficulty">Schwierigkeitsgrad:</label>
        <select id="difficulty" name="difficulty">
            <option value="leicht">Leicht</option>
            <option value="mittel">Mittel</option>
            <option value="schwer">Schwer</option>
        </select><br><br>  

        <label for="category">Kategorie:</label>
        <select id="category" name="category">
            <option value="vegan">Vegan</option>
            <option value="vegetarian">Vegetarisch</option>
            <option value="includingMeat">Mit Fleisch</option>
        </select><br><br>  

        <button id="createRecipeButton">Erstellen</button>
        </form>

        <!--Über das Script nochmal drüber schauen-->
        <script>
    
    $("#createRecipeButton").click(function(event){
        
        event.preventDefault(); 
        const ingredientsText = $("#zutaten").val();
        const ingredientsList = parseIngredients(ingredientsText);

        var recipeData = {
            name: $("#recipeTitel").val(),
            pictureUrl: "default.jpg", // platzhalter
            ingredients: ingredientsList, 
            instructions: $("#zubereitung").val(),      
            difficultyLevel: $("#difficulty").val(),
            category: $("#category").val()
        };

        // ist noch auf lokalen server später durch heroku ersetzten
        $.ajax({
            url: 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com',   
            type: 'POST',
            contentType: 'application/json',          
            data: JSON.stringify(recipeData),         
            success: function(response) {
                alert('Dein Rezept wurde erfolgreich hinzugefügt!');
                window.location.href = '../Homepage.html'; 
            },
            error: function(xhr, status, error) {
                alert('Fehler: Wir konnten dein Rezept nicht hinzufügen. Status: ' + xhr.status);
                console.error("Fehlerdetails:", error);
            }
        });
    });
    

    function parseIngredients(text) {
    const lines = text.split('\n');
    const ingredients = [];
    lines.forEach(line => {
        line = line.trim();
        if (!line) return;
        const parts = line.match(/^(\d*\.?\d*)\s*([a-zA-Z]*)\s*(.*)/);
        let amount = 0;
        let unit = '';
        let name = line; 
        if (parts && parts[3]) {
            amount = parseFloat(parts[1]) || 0;
            unit = parts[2] || '';
            name = parts[3].trim();
        } else {
             name = line.trim(); 
        }
        if (name) {
             ingredients.push({ amount: amount, unit: unit, name: name });
        }
        });
    return ingredients;
}


</script>


</body>
</html>