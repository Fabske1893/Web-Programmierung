<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F端ge ein neues Rezept hinzu</title>
    <link rel="stylesheet" href="../css/styleCreateRecipe.css">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
</head>
<header>
<nav>
    <a href="../Homepage.html">Startseite</a> &nbsp;&nbsp;
</nav>
<br>
</header>
<body>
     <form id="recipeForm" method="POST" enctype="multipart/form-data">
    <h1>Teilen sie ihre eigenen Rezepte mit anderen!</h1> <br>
    <h2>F端ge ein neues Rezept hinzu:</h2>
    <p></p>

        <label for="recipeTitel" >Titel:</label> <br>
        <textarea type="text" id="recipeTitel" name="titel" required ></textarea><br><br>

    
        <label for="image">Bild hochladen:</label> <br>
        <input type="file" id="image" name="image" accept="image/*"><br><br>
    

        <label for="zutaten">Zutaten:</label> <br>
        <textarea type="text" id="zutaten" name="zutaten" required ></textarea><br><br>

        <label for="zubereitung">Zubereitung:</label> <br>
        <textarea type="text" id="zubereitung" name="zubereitung" required ></textarea><br><br>

        <label for="difficulty">Schwierigkeitsgrad:</label>
        <select id="difficulty" name="difficulty">
            <option value="leicht">Leicht</option>
            <option value="mittel">Mittel</option>
            <option value="schwer">Schwer</option>
        </select><br><br>  

        <label for="category">Kategorie:</label>
        <select id="category" name="category">
            <option value="vegan">Vegan</option>
            <option value="vegetarian">Vegetarisch</option>
            <option value="includingMeat">Mit Fleisch</option>
        </select><br><br>  

        <button id="createRecipeButton" type="button" onclick="addRecipe()">Erstellen</button>

        </form>

        <script>
        
    const recipeForm = document.getElementById('recipeForm');

    
    

    function addRecipe() {
        const ingredientsText = $("#zutaten").val();
        
        
        const ingredientsList = parseIngredients(ingredientsText);

       
        const recipeData = {
    title: $("#recipeTitel").val(),
    imageUrl: $("#image").val(),
    ingredients: ingredientsList,
    instructions: $("#zubereitung").val(),
    difficulty: $("#difficulty").val(),
    category: $("#category").val(),
    likes: 0
};


        
        $.ajax({
            url: 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/api/recipes', 
            type: 'POST',
            contentType: 'application/json', 
            data: JSON.stringify(recipeData), 
            success: function(response) {
                alert('Dein Rezept wurde erfolgreich hinzugef端gt!');
                window.location.href = '../Homepage.html';
            },
            error: function(xhr, status, error) {
                let errorMsg = 'Fehler: Wir konnten dein Rezept nicht hinzuf端gen.';
                if (xhr.responseJSON && xhr.responseJSON.message) {
                    errorMsg += '\nServer sagt: ' + xhr.responseJSON.message;
                } else if (xhr.status === 0) {
                    errorMsg += '\nFehler: Netzwerkproblem oder Backend nicht erreichbar.';
                } else {
                    errorMsg += '\nStatus: ' + xhr.status;
                }
                alert(errorMsg);
                console.error("Fehlerdetails:", error);
            }
        });
    }

    
    function parseIngredients(text) {
        const lines = text.split('\n');
        const ingredients = [];
        lines.forEach(line => {
            line = line.trim();
            if (!line) return;
            
            const parts = line.match(/^(\d*\.?\d*)\s*([a-zA-Z]*)\s*(.*)/);
            let amount = 0;
            let unit = '';
            let name = line; 

            if (parts && parts[3]) { 
                amount = parseFloat(parts[1]) || 0;
                unit = parts[2] || '';
                name = parts[3].trim();
            } else {
                name = line.trim(); 
            }
            
            if (name) {
                 ingredients.push({ amount: amount, unit: unit, name: name });
            }
        });
        return ingredients;
    }
    </script>
</body>
</html>