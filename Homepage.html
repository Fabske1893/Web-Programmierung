<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    

</head>
<body>
    <header>
        <nav>
            <a href="login/Login.html">Log in</a> &nbsp;&nbsp;
            <a href="login/Logoff.html">Log off</a> &nbsp;&nbsp;
            <a href="recipes/CreateRecipe.html">Rezept hinzufügen</a> &nbsp;&nbsp;
            <a href="ShoppingList.html">Einkaufsliste</a> &nbsp;&nbsp;
            <a href="admin/adminUI.html">Rezepte löschen</a> &nbsp;&nbsp;
            <img src="images/account.png" alt="Logo" class="logo" onclick="goToAccount()">
        </nav>
        
    </header>


        
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
</head>
<body>
    <header>
        <nav>
            <a href="login/Login.html">Log in</a> &nbsp;&nbsp;
            <a href="login/Logoff.html">Log off</a> &nbsp;&nbsp;
            <a href="recipes/CreateRecipe.html">Rezept hinzufügen</a> &nbsp;&nbsp;
            <a href="ShoppingList.html">Einkaufsliste</a> &nbsp;&nbsp;
            <div id="adminLink" style="display: none; margin: 0; padding: 0; display: inline;">
                <a href="admin/adminUI.html">Rezepte löschen</a> &nbsp;&nbsp;
            </div>
            <img src="images/account.png" alt="Logo" class="logo" onclick="goToAccount()">
        </nav>
        <script>
            // Beim Laden der Seite prüfen
            document.addEventListener('DOMContentLoaded', function() {
                // Admin-Link initial ausblenden
                const adminLinkDiv = document.getElementById('adminLink');
                adminLinkDiv.style.display = 'none';
                
                // Prüfen ob Admin-User
                const userRole = localStorage.getItem('userRole');
                if (userRole === 'admin') {
                    adminLinkDiv.style.display = 'inline';
                }
            });
        </script>
    </header>

    <h1>Rezept und Einkaufslisten Appp</h1>
    <h2>Willkommen zur Rezept und Einkaufslisten App!</h2>
    <p>Finden Sie neue leckere Rezepte oder stellen Sie ihre Rezepte ganz einfach anderen zur Verfügung!</p>
    <p>Hier finden Sie alle verfügbaren Rezepte:</p>
 <div id="filterSortContainer">
    
        <div>
        <label for="filter">Filter:</label> <br>
       <select name="filter" id="filter">
            <option value="all">Alle</option>
            <option value="leicht">Einfach</option> <option value="mittel">Mittel</option> <option value="schwer">Schwer</option>   </select>
        </div>
        

        <h1>Rezept und Einkaufslisten App</h1>
        <h2>Willkommen zur Rezept und Einkaufslisten App!</h2>
        <p>Finden Sie neue leckere Rezepte oder stellen Sie ihre Rezepte ganz einfach anderen zur Verfügung!</p>

        <input type="search" name="searchRecipe" id="searchRecipe" placeholder="Suche Rezept..." oninput="searchRecipe()"> <br>
        <p>Hier finden Sie alle verfügbaren Rezepte:</p>
    <div id="filterSortContainer">
        
            <div>
            <label for="filter">Filtern nach Schwierigkeitsgrad:</label> <br>
            <select name="filter" id="filter" onchange="filterRecipes()">
                <option value="all">Alle</option>
                <option value="easy">Einfach</option>
                <option value="medium">Mittel</option>
                <option value="hard">Schwer</option>
            </select>
            </div>

            <div>
            <label for="filterCategory">Filtern nach Kategorie:</label> <br>
            <select name="filterCategory" id="filterCategory">
                <option value="all">Alle</option>
                <option value="vegan">Vegan</option>
                <option value="vegetarian">Vegetarsich</option>
                <option value="withMeat">Mit Fleisch</option>
            </select>
            </div>
            
        
        <div id="sortRecipes">
            
            <label for="sort">Sortieren nach:</label> <br>
            <select name="sort" id="sort">
                <option value="likes">Meiste Likes</option>
                <option value="alphabet">A-Z</option>
                <option value="date">Neuste zuerst</option>
            </select>   
            </div>
        </div>

        <br>
        <br/><br/>
        <ul id="recipeList">
            
        </ul>
        

        <script> 
                
                const graphqlQuery = `
                    query {
                    recipes {
                        id
                        imageUrl
                        title
                        difficulty
                        category
                        likes   
                    }
                    }
                `;

                $(document).ready(function() {
                    console.log("Sending POST on recipe of BFF with GraphQL query ...");
                    $.ajax({
                        url : 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/graphql',
                        type : 'post', 
                        contentType: 'application/json', 
                        dataType : 'json',
                        data: JSON.stringify({ 
                            query: graphqlQuery
                        }),
                        success : function(response) {
                            console.log('Rezepte erfolgreich geladen.');
                            console.log(response);
                            
                            const recipes = response.data.recipes;
                            
                            // Schleife bauen 
                            let htmlContent = '';
                            recipes.forEach(recipe => {
                                htmlContent += `
                                <li>
                                    <div class="recipe-card">
                                        <a href="./recipes/recipe-detail.html?id=${recipe.id}">
                                            <img src=${recipe.imageUrl} alt="Rezeptbild" class="recipe-image">
                                        </a>
                                        <h3>${recipe.title}</h3>
                                        <p>Kategorie: ${recipe.category}</p>
                                        <p>Likes: ${recipe.likes}</p>
                                        <p>Schwierigkeit: ${recipe.difficulty}</p>
                                    </div>
                                </li>
                                `;
                            });

                            $('#recipeList').html(htmlContent);

                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            alert('Rezepte konnten nicht geladen werden.');
                        }
                    });
                });
        </script>




    <br>



        <script src="js/functions.js" defer></script>
        <script src="js/sortRecipes.js" defer></script>


    <footer>
    <nav>
            
            <a href="./legal/Impressum.html">Impressum</a> &nbsp;&nbsp;
            <a href="./legal/Datenschutz.html">Datenschutz</a> &nbsp;&nbsp;
            <a href="login/Account.html">Mein Account</a> &nbsp;&nbsp;
            


        </nav>
        
    </footer>
</body>
</html>