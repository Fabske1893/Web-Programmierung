<!DOCTYPE html>
<html lang="de">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
    <script src="../js/functions.js"></script>
    <link rel="stylesheet" href="../css/style.css">
</head>
<header>
<nav>
    <a href="../Homepage.html">Startseite</a>
</nav>
</header>
<body>
    <div class="auth-wrapper">
        <div class="auth-card">
            <h1>Willkommen!</h1>
            <h2>Erstelle deinen Account</h2>
            <form id="registrationForm" novalidate>
                <label for="userName">Name</label>
                <input type="text" id="userName" name="username" required placeholder="Max Mustermann">

                <label for="userEmail">E-Mail</label>
                <input type="email" id="userEmail" name="email" required placeholder="name@example.com">

                <label for="userPassword">Passwort</label>
                <input type="password" id="userPassword" name="password" required placeholder="••••••••">

                <button type="submit" id="registration">Registrieren</button>
            </form>
            <p class="auth-helper">Du hast bereits ein Konto? <a href="../login/Login.html">Hier anmelden</a></p>
        </div>
    </div>

        <script>
        $("#registrationForm").on("submit", function(e){
            e.preventDefault();
            
            var registerUser = {
                username : $("#userName").val(),
                email: $("#userEmail").val(),
                password: $("#userPassword").val()
            };
            
            console.log("Sending POST to BFF for registration...");
            console.log(registerUser);
            
            $.ajax({
                url : 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/api/register',
                type : 'POST',
                dataType : 'json',
                contentType : 'application/json',
                data : JSON.stringify(registerUser),
                success : function(data) {
                    alert('Registrierung erfolgreich! Du kannst dich nun einloggen.');
                    window.location.href = '../login/Login.html';
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    if (xhr.status === 409) {
                        alert('Diese E-Mail ist bereits registriert.');
                    } else if (xhr.status === 400) {
                        alert('Bitte fülle alle Felder korrekt aus.');
                    } else {
                        alert('Registrierung fehlgeschlagen. Bitte versuche es erneut.');
                    }
                    console.error("Registrierungsfehler:", thrownError);
                }
            });
        });
    </script>
    
</body>
</html>