<!DOCTYPE html>
<html lang="de">
    <link rel="stylesheet" href="../css/style.css">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
    <title>Document</title>
</head>
<Header>
<nav>
    <a href="../Homepage.html">Zurück zur Startseite</a>
</nav>
<br>
</Header>
<body id="LoginBody">
    <h1>Hier können sie sich anmelden:</h1> <br>
    <h2>Log In</h2>
    <p></p>

    
        <label for="userEmail">Email:</label>
        <input type="email" id="userEmail" name="useremail" required><br><br>
        <label for="userPassword">Password:</label>
        <input type="password" id="userPassword" name="password" required><br><br>
        <button type="submit" value="Login" id="loginButton">Login</button>
        <br> <br>
        <p>Wenn sie noch kein Konto haben, können sie sich <a href="../register/Registration.html" id="link">hier</a> registrieren.</p>
</body>

<script>
    $("#loginButton").click(function(){
        var loginUser = {
            email : $("#userEmail").val(),
            password : $("#userPassword").val()
        };
        console.log("Sending post on login to BFF with user ...");
        console.log(loginUser);
        $.ajax({
            url : 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/api/login',
            type : 'POST',
            dataType : 'json',
            data : JSON.stringify(loginUser),
            contentType : 'application/json',
            success : function(response) {
                alert('You are now logged on.');
                localStorage.setItem('userToken', response.token);
                window.location.href = '../Homepage.html';
            },
            
            error: function(xhr, status, error) {
                if(xhr.status === 401){
                    alert('Anmeldung fehlgeschlagen: Falsche E-Mail oder Passwort.');
                }
                else {
                    alert('Anmeldung fehlgeschlagen. Server Fehler: ' + xhr.status);
                }
                localStorage.removeItem('userToken'); // Altes Token löschen
                console.error("Login-Fehler:", error);
        
            }
        });
    });
</script>
</html>