<!DOCTYPE html>
<html lang="de">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
    <title>Document</title>
</head>
<header>
<nav>
    <a href="../Homepage.html">Zurück zur Startseite</a>
</nav>
</header>
</Header>
<body id="LoginBody">
    <div class="auth-wrapper">
        <div class="auth-card">
            <h1>Hier können Sie sich anmelden</h1>
            <h2>Log In</h2>
            <form id="loginForm" novalidate>
                <label for="userEmail">E-Mail</label>
                <input type="email" id="userEmail" name="useremail" required placeholder="name@beispiel.com">

                <label for="userPassword">Passwort</label>
                <input type="password" id="userPassword" name="password" required placeholder="••••••••">

                <button type="submit" id="loginButton">Login</button>
            </form>
            <p class="auth-helper">Noch kein Konto? <a href="../register/Registration.html" id="link">Hier registrieren</a></p>
        </div>
    </div>
</body>

<script>
    $("#loginButton").click(function(e){
        e.preventDefault();
        var email = $("#userEmail").val();
        var password = $("#userPassword").val();

        // Admin-Schnellzugang (lokal, ohne Backend)
        if (email === "admin" && password === "admin") {
            localStorage.setItem('userRole', 'admin');
            alert('Willkommen Admin!');
            window.location.href = '../Homepage.html';
            return;
        }

        // Regulärer Login gegen Backend
        var loginUser = {
            email: email,
            password: password
        };
        console.log("Sending post on login to BFF with user ...");
        console.log(loginUser);
        $.ajax({
            url : 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/api/login',
            type : 'POST',
            dataType : 'json',
            data : JSON.stringify(loginUser),
            contentType : 'application/json',
            success : function(response) {
                alert('Sie sind jetzt eingeloggt.');
                localStorage.setItem('userToken', response.token);
                localStorage.setItem('userRole', 'user');
                window.location.href = '../Homepage.html';
            },
            
            error: function(xhr, status, error) {
                if(xhr.status === 401){
                    alert('Anmeldung fehlgeschlagen: Falsche E-Mail oder Passwort.');
                }
                else {
                    alert('Anmeldung fehlgeschlagen. Server Fehler: ' + xhr.status);
                }
                localStorage.removeItem('userToken'); // Altes Token löschen
                console.error("Login-Fehler:", error);
        
            }
        });
    });
</script>
</html>