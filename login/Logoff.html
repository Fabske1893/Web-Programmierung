<!DOCTYPE html>
<html lang="de">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <script type="text/javascript" src="../js/jquery-3.6.0.min.js"></script>
    <title>Document</title>
    
</head>
<Header>
<nav>
    <a href="../Homepage.html">Zurück zur Startseite</a>
</nav>
<br>
</Header>
<body>
    <div id="logoffContent">
        <h1 id="goodbyeMessage">Bis bald!</h1>
        <div id="logoffForm">
            <h2>Hier können Sie sich abmelden:</h2>
            <button type="button" id="logoffButton">Abmelden</button>
        </div>
    </div>
</body>

<script>
    $("#logoffButton").click(function(){
       
        $("#logoffForm").hide();
        $("#goodbyeMessage").show();
      
        // Token und Rolle aus LocalStorage entfernen (konsistente CamelCase-Schreibweise)
        localStorage.removeItem('userRole');
        localStorage.removeItem('userToken');
        
        var logoffUser = {
            token : localStorage.getItem("userToken")  // ✅ Korrigiert: userToken statt usertoken
        };
        console.log("Sending delete to logoff user ...");
        console.log(logoffUser);
        $.ajax({
            url : 'https://rezeptappbackend-a9a2cded5f95.herokuapp.com/api/logout',
            type : 'delete',
            dataType : 'json',
            contentType : 'application/json',
            success : function(data) {
                alert('Sie wurden erfolgreich abgemeldet!');
                // Sicherheitshalber nochmals entfernen
                localStorage.removeItem('userToken'); 
                localStorage.removeItem('userRole');
                window.location.href = "../Homepage.html";
            },
            data : JSON.stringify(logoffUser),
            processData : false,
            error: function(xhr, ajaxOptions, thrownError) {
                // Auch bei Fehler erfolgreich abmelden (LocalStorage ist bereits gelöscht)
                alert('Sie wurden erfolgreich abgemeldet!');
                // Zur Sicherheit nochmals entfernen
                localStorage.removeItem('userToken');
                localStorage.removeItem('userRole');
                window.location.href = "../Homepage.html";
            }
        });
    });
</script>

</html>