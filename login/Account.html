<!DOCTYPE html>
<html lang="de">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Account</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/jquery-3.6.0.min.js"></script>
    
</head>
<header>
<nav>
    <a href="../Homepage.html">Startseite</a>
    <a href="../login/Logoff.html">Abmelden</a>

</nav>

</header>
<body>
    <h1>Mein Account</h1>
    <h2>Hier finden Sie Ihre erstellten Rezepte:</h2>
    
    <ul id="recipeListUser">   </ul>

    <script>
        // Lädt Benutzerinfos und nur die Rezepte des eingeloggten Users
        const API_BASE = '';

        $(document).ready(function() {
            const token = localStorage.getItem('userToken');
            if (!token || token === 'OFF') {
                alert('Bitte logge dich ein, um deinen Account zu sehen.');
                window.location.href = '../login/Login.html';
                return;
            }
            loadUserRecipes(token);
        });

        async function loadUserRecipes(token) {
            const list = document.getElementById('recipeListUser');
            list.innerHTML = '<li>Lade deine Rezepte...</li>';

            // 1) Versuche GraphQL myRecipes mit  Token
            const gql = `query { myRecipes { id imageUrl title likes } }`;
            try {
                const resp = await fetch(`https://rezeptappbackend-a9a2cded5f95.herokuapp.com/graphql`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ query: gql })
                });
                const body = await resp.json();
                const recipes = body?.data?.myRecipes;
                if (Array.isArray(recipes)) {
                    renderRecipes(recipes);
                    return;
                }
            } catch (e) { /* Fallback */ }

           

            list.innerHTML = '<li style="color:red">Konnte deine Rezepte nicht laden.</li>';
        }

        function renderRecipes(recipes) {
            const list = document.getElementById('recipeListUser');
            if (!recipes || recipes.length === 0) {
                list.innerHTML = '<li>Du hast noch keine Rezepte erstellt.</li>';
                return;
            }
            let html = '';
            recipes.forEach(recipe => {
                const id = recipe.id;
                const title = recipe.title || 'Ohne Titel';
                const likes = recipe.likes || 0;
                const img = recipe.imageUrl || `../images/placeholder.png`;
                html += `
                <li>
                    <div class="recipe-card">
                        <a href="../recipes/recipe-detail.html?id=${id}">
                            <img src="${img}" alt="${title}" class="recipe-image" onerror="this.onerror=null;this.src='../images/placeholder.png';">
                        </a>
                        <h3>${title}</h3>
                        <p>Likes: ${likes}</p>
                        <button onclick="deleteRecipe(${id})">Rezept löschen</button>
                        <button onclick="editRecipe(${id})">Rezept bearbeiten</button>
                    </div>
                </li>`;
            });
            list.innerHTML = html;
        }

    </script>


<br>

   <div>Meine Likes: <span id="userLikes">
    0
   </span>

    </div>

   

      
</body>
</html>